<% layout('layouts/boilerplate')%>

<!-- 引入外部CSS文件 -->
<link rel="stylesheet" href="/styles/index.css" />

<!-- Hero Section with Map -->
<div class="hero-section mb-5">
  <div class="position-relative">
    <div
      id="map"
      style="
        width: 100%;
        height: 60vh;
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      "
    ></div>

    <!-- 固定的顶部标题栏 - 不阻挡地图点击 -->
    <div
      class="position-absolute top-0 start-0 w-100 p-4"
      style="pointer-events: none; z-index: 1"
    >
      <div class="d-flex justify-content-between align-items-center">
        <div class="text-white">
          <h1 class="h3 fw-bold mb-1 text-shadow">
            Discover Amazing Campgrounds
          </h1>
          <p class="mb-0 small text-shadow-sm">
            Find your perfect outdoor adventure
          </p>
        </div>
        <a
          href="/campgrounds/new"
          class="btn btn-success shadow-lg"
          style="pointer-events: auto"
        >
          <i class="fas fa-plus me-2"></i>Add Campground
        </a>
      </div>
    </div>
  </div>
</div>

<!-- Content Section -->
<div class="container-fluid px-6">
  <!-- Stats and Filter Bar -->
  <div class="row mb-4">
    <div class="col-12">
      <div
        class="d-flex justify-content-between align-items-center bg-light p-3 rounded-3 shadow-sm"
      >
        <div>
          <h2 class="h4 mb-1 text-primary">All Campgrounds</h2>
          <p class="mb-0 text-muted">
            <i class="fas fa-campground me-2"></i>
            <%= campgrounds.length %> campgrounds available
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Campgrounds Grid -->
  <div class="row g-4">
    <% for (let campground of campgrounds){%>
    <div class="col-lg-6 col-xl-4">
      <div class="card h-100 shadow-sm border-0 campground-card">
        <!-- Image Container -->
        <div class="position-relative overflow-hidden" style="height: 250px">
          <% if(campground.image.length) { %>
          <img
            class="card-img-top h-100 w-100"
            alt="<%= campground.title %>"
            src="<%= campground.image[0].url %>"
            style="object-fit: cover; transition: transform 0.3s ease"
          />
          <% } else { %>
          <img
            class="card-img-top h-100 w-100"
            alt="<%= campground.title %>"
            src="https://picsum.photos/400/300"
            style="object-fit: cover; transition: transform 0.3s ease"
          />
          <% } %>

          <!-- Price Badge -->
          <div class="position-absolute top-0 end-0 m-3">
            <span class="badge bg-success fs-6 px-3 py-2 shadow">
              $<%= campground.price %>/night
            </span>
          </div>

          <!-- Location Badge -->
          <div
            class="position-absolute bottom-0 start-0 w-100 p-3"
            style="background: linear-gradient(transparent, rgba(0, 0, 0, 0.7))"
          >
            <div class="text-white">
              <i class="fas fa-map-marker-alt me-1"></i>
              <small><%= campground.location %></small>
            </div>
          </div>
        </div>

        <!-- Card Body -->
        <div class="card-body d-flex flex-column">
          <h5 class="card-title text-primary mb-2 fw-bold">
            <%= campground.title %>
          </h5>

          <p
            class="card-text text-muted flex-grow-1"
            style="font-size: 0.9rem; line-height: 1.5"
          >
            <%= campground.description.length > 120 ?
            campground.description.substring(0, 120) + '...' :
            campground.description %>
          </p>

          <!-- Features/Amenities -->
          <div class="mb-3">
            <div class="d-flex flex-wrap gap-1">
              <span class="badge bg-light text-dark">
                <i class="fas fa-wifi text-primary"></i>
              </span>
              <span class="badge bg-light text-dark">
                <i class="fas fa-fire text-warning"></i>
              </span>
              <span class="badge bg-light text-dark">
                <i class="fas fa-shower text-info"></i>
              </span>
            </div>
          </div>

          <!-- Action Button -->
          <div class="mt-auto">
            <a
              class="btn btn-primary w-100 fw-semibold"
              href="/campgrounds/<%= campground._id %>"
            >
              <i class="fas fa-eye me-2"></i>View Details
            </a>
          </div>
        </div>
      </div>
    </div>
    <% }%>
  </div>
</div>

<script>
  const mapToken = "<%- process.env.MAPBOX_TOKEN %>";
  const campgrounds = <%- JSON.stringify(campgrounds) %>;
</script>
<script src="/js/clusterMap.js"></script>
